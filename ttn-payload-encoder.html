<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>TTN payload encoder</title>
        <script src="ttn-payload-encoder.js"></script>
        <style type="text/css">
            body{
                font-family: Arial, sans-serif;
            }
            table{
                border: 1px solid #ddd;
            }
            table th{
                text-align: left;
                padding: 5px;
            }
            table td{
                border-top: 1px solid #ddd;
                padding: 5px;
                vertical-align: top;
                width: 250px;
            }
            textarea{
                font-family: courier;
            }

            input, select
            {
                margin: 5px;
            }
            #decodedContent{
                position: relative;
                display: none;
            }

            #main-generate{
                width: 60%;
                float: left;
            }
            #main-send{
                width: 40%;
                float: right;
            }
        </style>
    </head>
    <body>
        <div id="main-generate">
            <h1>Choose encoding port</h1>
    
            <button onclick="generatePayload()" id="generation">Generate encoded message</button>
            <h4><span id="errorMessage"></span></h4>
            <h3>BYTES Result :</h3>
            <textarea id="bytes" cols="80" rows="2"></textarea>
            <h3>HEX Result :</h3>
            <textarea id="HEX" cols="80" rows="2"></textarea>
            <input id="decodingPort" type="number" name="port" min="0" max="9" value="3">
            <button onclick="test()">TEST</button>
            <h3>Decoder test result:</h3>
            <textarea id="decoder-result" cols="100" rows="10"></textarea>
    
            <table>
                <tbody>
                        <tr>
                            <td>
                                <div id="portStaticInput">
                                    <select id="portSelection" onChange="portChanged(this)">
                                        <option value="" disabled selected>Select your port</option>
                                        <option value="1">Port 1</option>
                                        <option value="2">Port 2</option>
                                        <option value="3">Port 3</option>
                                        <option value="4">Port 4</option>
                                    </select>
                                    <div id="payloadInputForm">
                                    
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr id="optionSelector">
    
                        </tr>
                </tbody>
            </table>
    
            <div id="decodedContent">
                <table id="decodedTable">
                    <thead>
                        <tr>
                            <th>Field</th>
                            <th>Value</th> 
                        </tr>
                    </thead>
                    <tbody id="decodedTableBody">
    
                    </tbody>
                </table>
            </div>
        </div>
        <div id="main-send">
            <h1>Sending payload to BEEP</h1>
            <select id="apiSelection" onChange="changeAPI(this)">
                <option value="" disabled selected>Choose your API</option>
                <option value="TTN">TTN</option>
                <option value="Other">Other</option>
            </select>
            <div id="APIFields">
                
            </div> 
        </div>
        <script>
            function test()
            {
                var port      = document.getElementById("decodingPort").value;
                var bytes     = document.getElementById("HEX").value;

                var byteArray       = new Uint8Array(bytes.length/2);
                var byteMem         = "0x";

                for(i=0 ; i < bytes.length+2 ; i++)
                {
                    if (i % 2 == 0 && i != 0)
                    {
                        var index = (i/2) - 1;
                        byteArray.fill(byteMem, index, index+1);
                        byteMem = "0x";
                    }

                    if (i < bytes.length)
                    {
                        byteMem += bytes[i];
                    }
                }
                
                //console.log('byteArray', byteArray)

                //console.log('payload_count', payload_count)
                //console.log('payload_spaced', payload_spaced)

                var decoded   = Decoder(byteArray, port);

                DisplayDecodedValue(decoded);

                console.log('decoded', decoded);
                document.getElementById("bytes").innerHTML = byteArray;
                document.getElementById("decoder-result").innerHTML = JSON.stringify(decoded);
            }
        </script>
    </body>
</html>